---
title: Developing a package to analyze data of the hospital morbidity survey
author: RMM
date: '2018-10-20'
slug: developing-a-package-to-analyze-data-of-the-hospital-morbidity-survey
categories:
  - R
  - Package
  - Morbidity
tags: []
---



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This post is going to be the most ambitious one so far. Months ago I decided to develope a R package from scratch to learn a little about the process. So I dug up some code I wrote and I got to the work. And of course, for a job like that you want to work properly so I followed <a href="http://r-pkgs.had.co.nz/">R packages by Hadley Wickham</a></p>
</div>
<div id="the-data" class="section level2">
<h2>The data</h2>
<p>My package downloads and gives functions to analyze data from the <a href="https://www.ine.es/dyngs/INEbase/en/operacion.htm?c=Estadistica_C&amp;cid=1254736176778&amp;menu=ultiDatos&amp;idp=1254735573175">Hospital morbidity survey</a> from <a href="https://www.ine.es/en/welcome.shtml">Spanish National Institute of Statistics</a>, this data is quite interesting for several reasons:</p>
<ul>
<li>Health data is a hot topic these days</li>
<li>Microdata are available from 1978</li>
<li>There is enough data to descriptive analysis and forecasting also</li>
</ul>
<p>One interesting thing in this data is that they have the code corresponding with the <a href="https://eciemaps.msssi.gob.es/ecieMaps/browser/metabuscador.html">International Classification of Diseases</a> which allows a highly detailled analysis. In the middle of the developing process new data were made available. Of course, theses are always good news, but… International Classification of Diseases changed from 9 version to 10. Important disclaimer here, I’m not a doctor and the assumptions I made to translate CIE10 to CIE9 can be wrong.</p>
</div>
<div id="the-package" class="section level2">
<h2>The package</h2>
<p>The package is hosted in the <a href="https://github.com/rOpenSpain/MorbiditySpainR">ROpenSpain gitlab</a> since I thougth it would give visibility and would made it more colaborative. <a href="https://github.com/rOpenSpain/MorbiditySpainR/blob/master/README.md">Here</a> you can find a very short intoduction to the package.</p>
</div>
<div id="some-descriptive-analysis" class="section level2">
<h2>Some descriptive analysis</h2>
<p>Once I developed the package (I may write another post with the details) I used it to make some descriptive analysis. This dataset is awesome and a lot of descriptive analysis can be done. Let’s have fun with data!!</p>
<div id="installing-the-package" class="section level3">
<h3>Installing the package</h3>
</div>
<div id="downloading-data" class="section level3">
<h3>Downloading data</h3>
<p>I want to get a dataset light enough to do some descriptive analysis with my personal laptop so I dowload data from 2010 to 2014.</p>
<pre><code>## Observations: 23,069,431
## Variables: 10
## $ prov_hosp     &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ...
## $ sexo          &lt;int&gt; 1, 1, 1, 1, 2, 2, 1, 1, 1, 1, 2, 1, 1, 2, 2, 2, ...
## $ prov_res      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ...
## $ diag_in       &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ...
## $ diag_ppal     &lt;chr&gt; &quot;3019&quot;, &quot;3770&quot;, &quot;5532&quot;, &quot;2851&quot;, &quot;8518&quot;, &quot;7865&quot;, ...
## $ motivo_alta   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 3, 1, 1, 3, ...
## $ estancia      &lt;int&gt; 3, 1, 2, 1, 1, 2, 1, 2, 2, 4, 5, 20, 1, 3, 6, 1,...
## $ cie           &lt;dbl&gt; 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, ...
## $ fecha_ingreso &lt;date&gt; 2010-08-29, 2010-04-30, 2010-04-29, 2009-12-31,...
## $ edad          &lt;int&gt; 55, 90, 60, 45, 62, 55, 61, 66, 25, 46, 100, 46,...</code></pre>
</div>
<div id="exploratory-analysis" class="section level3">
<h3>Exploratory analysis</h3>
<p>Regrettably we have an issue here in Spain with consumption of alcohol by minors, some times this consumption may end up in a hospital emergency, so let’s find out this in our data.</p>
<p><img src="/post/2018-10-20-developing-a-package-to-analyze-data-of-the-hospital-morbidity-survey_files/figure-html/explo1-1.png" width="672" /></p>
<p>Otro análisis exploratorio que nos permite hacer este conjunto de datos tiene como objetivo conocer cuales son los esguinces más comunes en las personas entre 30 y 45 años, separando los resultados por sexos.</p>
<p>Another descriptive analysis we can do with dataset has the goal of knowing which are the most common sprain in people between 30 and 45 years, splitting resulst by sex.</p>
<p><img src="/post/2018-10-20-developing-a-package-to-analyze-data-of-the-hospital-morbidity-survey_files/figure-html/explo2-1.png" width="672" /></p>
<p>The next analysis imitates the famous <a href="https://en.wikipedia.org/wiki/MythBusters">Myth busters</a> with data and answer the question of whether they are born more babies with full moon.</p>
<p><img src="/post/2018-10-20-developing-a-package-to-analyze-data-of-the-hospital-morbidity-survey_files/figure-html/explo3-1.png" width="672" /></p>
<p>Un último ejemplo de análisis exploratorio nos puede servir para construir una serie temporal de los ingresos hospitalarios de menores por enfermedades respiratorias (gripe y neumonía) en la Comunidad de Madrid y confrontarla con una serie climatológica para poder señalar episodios epidemiológicos.</p>
<p>The last example builds a temporal series of hospital admissions of minors related with repiratorial diseases (flu and pneumonia) in Madrid. With this temporal serie we can construct a mean serie and compare them both to find epimediological episodes.</p>
<p><img src="/post/2018-10-20-developing-a-package-to-analyze-data-of-the-hospital-morbidity-survey_files/figure-html/explo4-1.png" width="672" /></p>
</div>
</div>
<div id="coming-next" class="section level2">
<h2>Coming next</h2>
<ul>
<li>Predictive anlysis</li>
<li>Big data</li>
</ul>
</div>
